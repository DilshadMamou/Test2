<!DOCTYPE html>
<html>

<head>
    <title>Nice image capture button</title>
</head>

<body>
<label class="cameraButton">Take a picturee
    <input type="file" accept="image/*" id="cameraImg" onchange="logFile()" capture>

</label>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj"
        crossorigin="anonymous"></script>
<script>
    function getUrlParam(parameter, defaultvalue) {
        var urlParameter = defaultvalue;
        if (window.location.href.indexOf(parameter) > -1) {
            urlParameter = getUrlVars()[parameter];
        }
        return urlParameter;
    }

    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }

    function logFile() {
        uploadFile(860536040824445, "phone-uploaded-img.jpg");
    }

    function uploadFile(deviceImei, fileName) {
        var file = document.getElementById("cameraImg").files[0];
                 $.ajax({
                ///url: 'https://gps-dev.idynamics.ch/addDocument.php?id=idynamics&key=da5c9131fb3d39e66ad969bfe512f4dcf5f676ba&document_name=' + fileName + '&imei=' + deviceImei,
                 url: 'https://gps-dev.idynamics.ch/addDocument.php?id=' + getUrlParam("id", "") + '&key=' + getUrlParam("key", "") + '&document_name=' + fileName.name + '&imei=' + deviceImei,
                type: "post",
                data: file,
                processData: false,
                contentType: false,
                xhr: function () {
                    var jqXHR;
                    if (window.ActiveXObject) {
                        jqXHR = new window.ActiveXObject("Microsoft.XMLHTTP");
                    } else {
                        jqXHR = new window.XMLHttpRequest();
                    }
                    jqXHR.upload.addEventListener("progress", function (evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = Math.round((evt.loaded * 100) / evt.total);
                            console.log(percentComplete);
                        }
                    }, false);

                    return jqXHR;
                },
                success: function (result) {
                    console.log("result");
                    console.log(result);
                    alert("result");
                    alert(result.stringify());
                },
                error: function (error) {
                    console.log("error");
                    console.log(error);
                    alert("error");
                    alert(error.stringify());
                }
            });
    }
</script>
</body>

</html>